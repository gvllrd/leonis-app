<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Validation Post</title>
    <style>
        /* --- DESIGN SYSTEM "PURE WHITE" --- */
        :root {
            --bg-body: #F5F7FA;
            --card-bg: #FFFFFF;
            --text-dark: #1A202C;
            --text-grey: #718096;
            --radius: 24px;
            --shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.08);
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-dark);
            font-family: var(--font-main);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding-bottom: 100px;
        }

        #app {
            width: 100%;
            max-width: 480px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* 1. TITRE */
        .card-header {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            text-align: center;
            animation: slideUp 0.3s ease-out;
            border-left: 5px solid #000;
        }
        .card-header h1 {
            font-size: 22px;
            margin: 0;
            font-weight: 800;
            line-height: 1.3;
        }
        .card-header p {
            font-size: 11px;
            color: var(--text-grey);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 8px;
            font-weight: 700;
        }

        /* 2. TEXTE */
        .card-text {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            animation: slideUp 0.4s ease-out;
        }
        .caption-content {
            font-size: 16px;
            line-height: 1.6;
            color: #2D3748;
            white-space: pre-wrap;
        }

        /* 3. HASHTAGS */
        .card-tags {
            background: transparent;
            padding: 0 10px;
            color: #3182CE;
            font-weight: 600;
            font-size: 14px;
            line-height: 1.5;
            animation: slideUp 0.5s ease-out;
            text-align: center;
            display: none;
        }

        /* 4. MEDIA */
        .media-container {
            width: 100%;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            background: #000;
            position: relative;
            animation: scaleIn 0.5s ease-out;
            min-height: 250px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .media-container img, .media-container video {
            width: 100%;
            height: auto;
            max-height: 600px;
            object-fit: contain;
            display: block;
        }

        /* 5. STATS */
        .card-stats {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            animation: slideUp 0.6s ease-out;
        }
        .stat-item { text-align: center; width: 48%; }
        .stat-label { font-size: 10px; color: var(--text-grey); text-transform: uppercase; font-weight: bold; display: block; margin-bottom: 5px;}
        .stat-value { font-size: 14px; font-weight: 700; color: var(--text-dark); }

        /* BOUTON */
        .footer-action {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            background: rgba(245, 247, 250, 0.95);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            z-index: 100;
        }
        .btn-validate {
            background-color: var(--text-dark);
            color: #FFF;
            border: none;
            padding: 16px 40px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            width: 100%;
            max-width: 440px;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        /* LOADER */
        .loader-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100vh;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg-body); z-index: 200;
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid #E2E8F0;
            border-left-color: var(--text-dark); border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes scaleIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <div id="loader" class="loader-container"><div class="spinner"></div></div>

    <div id="app" style="display:none;">
        
        <div class="card-header">
            <h1 id="post-title">...</h1>
            <p id="network-subtitle">Titre du Post</p>
        </div>

        <div class="card-text">
            <div id="post-text" class="caption-content"></div>
        </div>

        <div id="post-hashtags" class="card-tags"></div>

        <div class="media-container">
            <img id="post-image" src="" alt="Post" style="display:none;">
            <video id="post-video" controls playsinline loop style="display:none;">
                <source id="video-source" src="" type="video/mp4">
            </video>
        </div>

        <div class="card-stats">
            <div class="stat-item">
                <span class="stat-label">Objectif</span>
                <span id="stat-objective" class="stat-value">...</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Projection ROI</span>
                <span id="stat-roi" class="stat-value">...</span>
            </div>
        </div>
    </div>

    <div class="footer-action">
        <button class="btn-validate" onclick="closeWindow()">Valider & Fermer</button>
    </div>

    <script>
        // ðŸ‘‡ðŸ‘‡ TON URL MAKE (ScÃ©nario 3) ðŸ‘‡ðŸ‘‡
        const API_URL = "https://hook.eu1.make.com/d2bftkhlh5qkirvb5uia3nvhuv4ebxze"; 

        const params = new URLSearchParams(window.location.search);
        const storeId = params.get('store_id');
        const network = params.get('net');

        const networksPretty = {
            'instagram': 'Instagram', 'facebook': 'Facebook', 'twitter': 'X / Twitter',
            'linkedin': 'LinkedIn', 'tiktok': 'TikTok', 'youtube': 'YouTube',
            'pinterest': 'Pinterest', 'google': 'Google', 'threads': 'Threads', 'snapchat': 'Snapchat'
        };

        function isVideo(url) {
            if (!url) return false;
            const lowerUrl = url.toLowerCase();
            return lowerUrl.includes('.mp4') || lowerUrl.includes('.mov') || lowerUrl.includes('video');
        }

        async function loadData() {
            try {
                const response = await fetch(`${API_URL}?store_id=${storeId}`);
                const data = await response.json();
                
                const netData = data.networks && data.networks[network] ? data.networks[network] : {};

                // 1. MEDIA
                const mediaUrl = data.media_url;
                const imgElement = document.getElementById('post-image');
                const vidElement = document.getElementById('post-video');
                const vidSource = document.getElementById('video-source');

                if (isVideo(mediaUrl)) {
                    imgElement.style.display = 'none';
                    vidElement.style.display = 'block';
                    vidSource.src = mediaUrl;
                    vidElement.load();
                } else {
                    vidElement.style.display = 'none';
                    imgElement.style.display = 'block';
                    imgElement.src = mediaUrl;
                }

                // 2. TEXTE & TITRES
                document.getElementById('post-title').innerText = netData.title || networksPretty[network];
                document.getElementById('network-subtitle').innerText = "AperÃ§u " + (networksPretty[network] || network);
                document.getElementById('post-text').innerText = netData.caption || "Texte en cours de gÃ©nÃ©ration...";

                // 3. HASHTAGS
                const tagsBox = document.getElementById('post-hashtags');
                if (netData.tags && netData.tags.length > 2) {
                    tagsBox.innerText = netData.tags;
                    tagsBox.style.display = 'block';
                } else {
                    tagsBox.style.display = 'none';
                }

                // 4. STATS
                document.getElementById('stat-objective').innerText = netData.objective || "-";
                document.getElementById('stat-roi').innerText = netData.roi || "-";

                // AFFICHAGE
                document.getElementById('loader').style.display = 'none';
                document.getElementById('app').style.display = 'flex';

            } catch (error) {
                console.error(error);
                document.getElementById('loader').innerHTML = "<p style='text-align:center; padding:20px;'>Erreur de chargement.<br>VÃ©rifie ton ID boutique.</p>";
            }
        }

        function closeWindow() {
            window.close();
            document.body.innerHTML = "<div style='display:flex;justify-content:center;align-items:center;height:100vh;background:#F5F7FA;color:#1A202C;'><h1>C'est validÃ© ! âœ…</h1></div>";
        }

        if(storeId && network) {
            loadData();
        } else {
            document.getElementById('loader').innerHTML = "<p style='text-align:center'>Lien incomplet.</p>";
        }
    </script>
</body>
</html>
