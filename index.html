<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Leonis Dashboard</title>
    <style>
        /* --- DESIGN SYSTEM "PURE WHITE" --- */
        :root {
            --bg-body: #F5F7FA; /* Gris trÃ¨s clair pour le fond de page */
            --card-bg: #FFFFFF; /* Blanc pur pour les cartes */
            --text-dark: #1A202C; /* Noir doux */
            --text-grey: #718096; /* Gris texte */
            --accent: #000000;    /* Noir pur pour les accents */
            --shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.08); /* L'ombrage doux style screenshot */
            --radius: 24px; /* Arrondi des cartes */
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-dark);
            font-family: var(--font-main);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding-bottom: 100px; /* Espace pour le bouton fixe */
        }

        #app {
            width: 100%;
            max-width: 480px; /* Format mobile strict */
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px; /* Espace entre les boites */
        }

        /* --- 1. BOITE TITRE --- */
        .card-header {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
            animation: slideUp 0.3s ease-out;
        }
        .card-header h1 {
            font-size: 24px;
            margin: 0;
            font-weight: 800;
            letter-spacing: -0.5px;
        }
        .card-header p {
            color: var(--text-grey);
            font-size: 13px;
            margin: 5px 0 0 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        /* --- 2. BOITE DESCRIPTION --- */
        .card-text {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            animation: slideUp 0.4s ease-out;
        }
        .caption-content {
            font-size: 16px;
            line-height: 1.6;
            color: #2D3748;
            white-space: pre-wrap;
        }

        /* --- 3. BOITE HASHTAGS --- */
        .card-hashtags {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 15px 25px;
            color: #3182CE; /* Bleu hashtag */
            font-weight: 600;
            font-size: 14px;
            line-height: 1.5;
            animation: slideUp 0.45s ease-out;
            display: none; /* CachÃ© par dÃ©faut si vide */
        }

        /* --- 4. BOITE MEDIA (PHOTO/VIDEO) --- */
        .media-container {
            width: 100%;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            background: #000;
            position: relative;
            animation: scaleIn 0.5s ease-out;
            /* Pas de hauteur fixe, s'adapte au contenu */
        }
        .media-container img, .media-container video {
            width: 100%;
            height: auto;
            display: block;
        }

        /* --- 5. BOITE ROI & OBJECTIFS --- */
        .card-stats {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 25px;
            animation: slideUp 0.6s ease-out;
        }
        .stat-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        .stat-row:last-child { margin-bottom: 0; }
        
        .stat-icon { font-size: 20px; margin-right: 15px; width: 25px; text-align: center; }
        .stat-label { font-size: 12px; color: var(--text-grey); text-transform: uppercase; font-weight: bold; display: block; }
        .stat-value { font-size: 16px; font-weight: 700; color: var(--text-dark); }

        /* --- BOUTON FIXE --- */
        .footer-action {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            background: rgba(245, 247, 250, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            box-sizing: border-box;
            z-index: 100;
        }
        .btn-validate {
            background-color: var(--text-dark);
            color: #FFF;
            border: none;
            padding: 18px 40px;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 700;
            width: 100%;
            max-width: 440px;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            transition: transform 0.1s;
        }
        .btn-validate:active { transform: scale(0.98); }

        /* --- LOADER --- */
        .loader-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100vh;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: var(--bg-body); z-index: 200;
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid #E2E8F0;
            border-left-color: var(--text-dark); border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes scaleIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    </style>
</head>
<body>

    <div id="loader" class="loader-container">
        <div class="spinner"></div>
    </div>

    <div id="app" style="display:none;">
        
        <div class="card-header">
            <h1>Leonis V1</h1>
            <p>Dashboard de Validation</p>
        </div>

        <div class="card-text">
            <div id="post-text" class="caption-content"></div>
        </div>

        <div id="post-hashtags" class="card-hashtags"></div>

        <div class="media-container">
            <img id="post-image" src="" alt="Post" style="display:none;">
            <video id="post-video" controls playsinline loop style="display:none;">
                <source id="video-source" src="" type="video/mp4">
            </video>
        </div>

        <div class="card-stats">
            <div class="stat-row">
                <div class="stat-icon">ðŸŽ¯</div>
                <div>
                    <span class="stat-label">StratÃ©gie</span>
                    <span id="stat-objective" class="stat-value">...</span>
                </div>
            </div>
            <div class="stat-row">
                <div class="stat-icon">ðŸ’¸</div>
                <div>
                    <span class="stat-label">Projection ROI</span>
                    <span id="stat-roi" class="stat-value">...</span>
                </div>
            </div>
        </div>

    </div>

    <div class="footer-action" id="footer" style="display:none;">
        <button class="btn-validate" onclick="closeWindow()">Valider & Fermer</button>
    </div>

    <script>
        // ðŸ‘‡ðŸ‘‡ TON URL MAKE (J'AI BIEN MIS LA BONNE CETTE FOIS) ðŸ‘‡ðŸ‘‡
        const API_URL = "https://hook.eu1.make.com/d2bftkhlh5qkirvb5uia3nvhuv4ebxze"; 

        const params = new URLSearchParams(window.location.search);
        const storeId = params.get('store_id');
        const network = params.get('net');

        // Regex pour extraire les hashtags
        function extractHashtags(text) {
            const hashtags = text.match(/#[a-z0-9_]+/gi);
            return hashtags ? hashtags.join(' ') : '';
        }

        // Fonction pour nettoyer le texte des hashtags (optionnel, sinon on garde tout)
        function removeHashtags(text) {
            // On peut choisir de laisser les tags dans le texte ou pas. 
            // Ici je laisse le texte brut pour Ã©viter de casser la phrase.
            return text; 
        }

        function isVideo(url) {
            if (!url) return false;
            const lowerUrl = url.toLowerCase();
            return lowerUrl.includes('.mp4') || lowerUrl.includes('.mov') || lowerUrl.includes('video');
        }

        async function loadData() {
            try {
                const response = await fetch(`${API_URL}?store_id=${storeId}`);
                const data = await response.json();
                const netData = data.networks && data.networks[network] ? data.networks[network] : null;

                // 1. MEDIA
                const mediaUrl = data.media_url;
                const imgElement = document.getElementById('post-image');
                const vidElement = document.getElementById('post-video');
                const vidSource = document.getElementById('video-source');

                if (isVideo(mediaUrl)) {
                    imgElement.style.display = 'none';
                    vidElement.style.display = 'block';
                    vidSource.src = mediaUrl;
                    vidElement.load();
                } else {
                    vidElement.style.display = 'none';
                    imgElement.style.display = 'block';
                    imgElement.src = mediaUrl;
                }

                // 2. TEXTE
                let rawText = netData ? netData.caption : "Aucun texte.";
                document.getElementById('post-text').innerText = rawText;

                // 3. HASHTAGS (Extraction pour la boite sÃ©parÃ©e)
                const tags = extractHashtags(rawText);
                const hashBox = document.getElementById('post-hashtags');
                
                if(tags.length > 0) {
                    hashBox.innerText = tags;
                    hashBox.style.display = 'block';
                } else {
                    hashBox.style.display = 'none';
                }

                // 4. STATS (ROI & OBJ)
                document.getElementById('stat-objective').innerText = netData ? netData.objective : "-";
                document.getElementById('stat-roi').innerText = netData ? netData.roi : "-";

                // AFFICHAGE
                document.getElementById('loader').style.display = 'none';
                document.getElementById('app').style.display = 'flex';
                document.getElementById('footer').style.display = 'flex';

            } catch (error) {
                console.error(error);
                document.getElementById('loader').innerHTML = "<p style='text-align:center'>Erreur de chargement.</p>";
            }
        }

        function closeWindow() {
            window.close();
            document.body.innerHTML = "<div style='display:flex;justify-content:center;align-items:center;height:100vh;background:#F5F7FA;color:#1A202C;'><h1>C'est validÃ© ! âœ…</h1></div>";
        }

        if(storeId && network) {
            loadData();
        } else {
            document.getElementById('loader').innerHTML = "<p style='text-align:center'>Lien incomplet.</p>";
        }
    </script>
</body>
</html>
